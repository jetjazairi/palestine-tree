<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A Tree of Hearts for Palestine</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to top, #cdeffd, #f5f5f5);
      text-align: center;
    }

    h1 { margin-top: 30px; font-size: 2.2em; }
    p { font-size: 1.1em; margin: 10px; }

    svg { margin: 20px auto; display: block; }

    .heart {
      font-size: 18px;
      animation: bloom 1s ease forwards, heartbeat 1.2s ease 1s;
    }
    .flag { font-size: 18px; }
    .flower { font-size: 16px; animation: bloom 1s ease forwards; }

    @keyframes bloom {
      0% { transform: scale(0); opacity: 0; }
      60% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes heartbeat {
      0% { transform: scale(1); }
      30% { transform: scale(1.4); }
      60% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }

    #branches path { transition: d 1s ease-in-out; }

    button {
      margin-top: 20px;
      padding: 14px 25px;
      font-size: 18px;
      background: #006400;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover { background: #228B22; transform: scale(1.05); }

    .counter { margin: 15px 0; font-size: 1.3em; font-weight: bold; }
    .daily-message { font-style: italic; color: #444; margin-bottom: 20px; }

    .floating-heart {
      position: absolute;
      font-size: 18px;
      color: red;
      animation: floatUp 1s ease forwards;
      pointer-events: none;
    }

    @keyframes floatUp {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(-40px); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>üíö A Tree of Hearts for Palestine üíö</h1>
  <p>Every click is a heartbeat of solidarity. Together, our love makes the tree flourish.</p>

  <!-- SVG Tree -->
  <svg id="tree-svg" width="400" height="500" viewBox="0 0 400 500">
    <!-- Aura (hidden until 1000 clicks) -->
    <circle id="aura" cx="200" cy="220" r="150" fill="rgba(255,223,0,0.3)" visibility="hidden"/>

    <!-- Trunk -->
    <rect id="trunk" x="190" y="370" width="20" height="80" fill="sienna" rx="8"/>

    <!-- Canopy -->
    <circle id="canopy" cx="200" cy="220" r="40" fill="url(#canopyGradient)" />

    <!-- Branches -->
    <g id="branches" stroke="#654321" stroke-width="3" fill="none" style="display:none;">
      <path id="branch-left" d="M200,300 Q190,290 180,280" />
      <path id="branch-right" d="M200,300 Q210,290 220,280" />
      <path id="branch-upper-left" d="M200,270 Q195,260 190,250" />
      <path id="branch-upper-right" d="M200,270 Q205,260 210,250" />
    </g>

    <!-- Gradients -->
    <defs>
      <radialGradient id="canopyGradient">
        <stop offset="0%" stop-color="#7CFC00"/>
        <stop offset="100%" stop-color="#006400"/>
      </radialGradient>
    </defs>
  </svg>

  <!-- Button -->
  <div id="button-container" style="position: relative; display: inline-block;">
    <button onclick="plantHeart()">üíö Give a Heart of Solidarity</button>
  </div>

  <!-- Counter -->
  <div class="counter">Total Hearts Given: <span id="counter">0</span></div>
  <div class="daily-message">‚ú® Come back tomorrow and see how many more hearts have grown on our tree. ‚ú®</div>

  <!-- Heartbeat sound -->
  <audio id="heart-sound" preload="auto">
    <source src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" type="audio/ogg">
    <source src="https://actions.google.com/sounds/v1/cartoon/pop.mp3" type="audio/mpeg">
  </audio>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // üî• Replace with your Firebase config
        const firebaseConfig = {
      apiKey: "AIzaSyCGfqZx9kvYzHQokU9a5wlgbd_x-Yugx4g",
      authDomain: "palestine-tree.firebaseapp.com",
      projectId: "palestine-tree",
      storageBucket: "palestine-tree.firebasestorage.app",
      messagingSenderId: "47294950321",
      appId: "1:47294950321:web:2719cdf8d549f54ab6eb90",
      measurementId: "G-0Y6F2CE5NV"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const counter = document.getElementById('counter');
    const canopy = document.getElementById('canopy');
    const trunk = document.getElementById('trunk');
    const aura = document.getElementById('aura');
    const svg = document.getElementById('tree-svg');

    let localBuffer = 0;

    // üîÑ Batched write every 10s
    setInterval(() => {
      if (localBuffer > 0) {
        firebase.database().ref("clicks").transaction(c => (c || 0) + localBuffer);
        localBuffer = 0;
      }
    }, 10000);

    // Live sync
    db.ref("clicks").on("value", snapshot => {
      const clicks = snapshot.val() || 0;
      counter.textContent = clicks;
      growTree(clicks);
    });

    function plantHeart() {
      localBuffer += 1; // add to batch

      // Play sound
      const sound = document.getElementById("heart-sound");
      sound.currentTime = 0;
      sound.play();

      // Floating +1 ‚ù§Ô∏è
      const btnContainer = document.getElementById('button-container');
      const float = document.createElement('div');
      float.classList.add('floating-heart');
      float.textContent = "+1 ‚ù§Ô∏è";
      float.style.left = "50%";
      float.style.top = "-10px";
      float.style.transform = "translateX(-50%)";
      btnContainer.appendChild(float);
      setTimeout(() => float.remove(), 1000);

      // Instant local visual feedback
      addHeartOnBranch(Date.now());
    }

    function growTree(clicks) {
      // Canopy growth
      let newRadius = 40 + Math.min(clicks, 1000) / 4;
      canopy.setAttribute("r", newRadius);

      // Trunk growth
      let newHeight = 80 + Math.min(clicks, 1000) / 2;
      let newWidth = 20 + Math.min(clicks, 1000) / 40;
      trunk.setAttribute("y", 450 - newHeight);
      trunk.setAttribute("height", newHeight);
      trunk.setAttribute("width", newWidth);
      trunk.setAttribute("x", 200 - newWidth/2);

      // Branch growth after 100 clicks
      if (clicks >= 100) {
        document.getElementById("branches").style.display = "inline";
        updateBranches(clicks);
      }

      // Milestones
      if (clicks >= 500 && clicks % 10 === 0) addFlowerOnBranch();
      if (clicks >= 1000) aura.setAttribute("visibility", "visible");
    }

    function updateBranches(clicks) {
      const growthFactor = Math.min(clicks, 500) / 500;

      document.getElementById("branch-left")
        .setAttribute("d", `M200,300 Q${170 - 40*growthFactor},${250 - 30*growthFactor} ${150 - 40*growthFactor},${200 - 50*growthFactor}`);

      document.getElementById("branch-right")
        .setAttribute("d", `M200,300 Q${230 + 40*growthFactor},${250 - 30*growthFactor} ${250 + 40*growthFactor},${200 - 50*growthFactor}`);

      document.getElementById("branch-upper-left")
        .setAttribute("d", `M200,270 Q${185 - 20*growthFactor},${240 - 20*growthFactor} ${160 - 30*growthFactor},${180 - 40*growthFactor}`);

      document.getElementById("branch-upper-right")
        .setAttribute("d", `M200,270 Q${215 + 20*growthFactor},${240 - 20*growthFactor} ${240 + 30*growthFactor},${180 - 40*growthFactor}`);
    }

    function addHeartOnBranch(index) {
      const colors = ["üíö", "‚ù§Ô∏è", "ü§ç", "üñ§"];
      const heart = document.createElementNS("http://www.w3.org/2000/svg", "text");
      heart.textContent = colors[index % colors.length];
      heart.setAttribute("class", "heart");

      // Pick random branch
      const branchIds = ["branch-left", "branch-right", "branch-upper-left", "branch-upper-right"];
      const branch = document.getElementById(branchIds[Math.floor(Math.random() * branchIds.length)]);
      const length = branch.getTotalLength();
      const pos = branch.getPointAtLength(Math.random() * length);

      heart.setAttribute("x", pos.x);
      heart.setAttribute("y", pos.y);
      svg.appendChild(heart);
    }

    function addFlowerOnBranch() {
      const flower = document.createElementNS("http://www.w3.org/2000/svg", "text");
      flower.textContent = "üå∏";
      flower.setAttribute("class", "flower");

      const branchIds = ["branch-left", "branch-right", "branch-upper-left", "branch-upper-right"];
      const branch = document.getElementById(branchIds[Math.floor(Math.random() * branchIds.length)]);
      const length = branch.getTotalLength();
      const pos = branch.getPointAtLength(Math.random() * length);

      flower.setAttribute("x", pos.x);
      flower.setAttribute("y", pos.y);
      svg.appendChild(flower);
    }
  </script>
</body>
</html>
